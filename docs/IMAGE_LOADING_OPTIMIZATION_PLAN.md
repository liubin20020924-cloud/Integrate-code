# äº‘æˆ·ç§‘æŠ€ç½‘ç«™ - å›¾ç‰‡åŠ è½½ä¼˜åŒ–æ–¹æ¡ˆ

> å…¬ç½‘å›¾ç‰‡åŠ è½½æ€§èƒ½ä¼˜åŒ–å®Œæ•´æ–¹æ¡ˆ

---

## ğŸ“‹ ç›®å½•

- [é—®é¢˜åˆ†æ](#-é—®é¢˜åˆ†æ)
- [ä¼˜åŒ–ç›®æ ‡](#-ä¼˜åŒ–ç›®æ ‡)
- [ä¼˜åŒ–è·¯çº¿å›¾](#-ä¼˜åŒ–è·¯çº¿å›¾)
- [ä¸€ã€å›¾ç‰‡å‹ç¼©ä¼˜åŒ–](#ä¸€å›¾ç‰‡å‹ç¼©ä¼˜åŒ–)
- [äºŒã€å›¾ç‰‡æ ¼å¼ä¼˜åŒ–](#äºŒå›¾ç‰‡æ ¼å¼ä¼˜åŒ–)
- [ä¸‰ã€CDNåŠ é€Ÿ](#ä¸‰cdnåŠ é€Ÿ)
- [å››ã€Redisç¼“å­˜](#å››redisç¼“å­˜)
- [äº”ã€å‰ç«¯ä¼˜åŒ–](#äº”å‰ç«¯ä¼˜åŒ–)
- [å…­ã€Nginxä¼˜åŒ–](#å…­nginxä¼˜åŒ–)
- [ä¸ƒã€ä»£ç å®ç°æ–¹æ¡ˆ](#ä¸ƒä»£ç å®ç°æ–¹æ¡ˆ)
- [å…«ã€å®æ–½æ­¥éª¤](#å…«å®æ–½æ­¥éª¤)
- [ä¹ã€æ•ˆæœè¯„ä¼°](#ä¹æ•ˆæœè¯„ä¼°)

---

## ğŸ” é—®é¢˜åˆ†æ

### å½“å‰å›¾ç‰‡èµ„æºæ¸…å•

| ç›®å½• | å›¾ç‰‡æ•°é‡ | ä¸»è¦æ–‡ä»¶ | ä¼°è®¡å¤§å° |
|------|---------|---------|---------|
| `static/home/images/` | 20+ | Logo1-6.jpg, sy.jpg, wx.jpg, BJ/ç›®å½• | ~15MB |
| `static/kb/images/` | 1 | Logo.jpg | ~500KB |
| `static/case/images/` | 1 | Logo.jpg | ~500KB |
| **æ€»è®¡** | **25+** | - | **~16MB** |

### å›¾ç‰‡ä½¿ç”¨åœºæ™¯åˆ†æ

| åœºæ™¯ | å›¾ç‰‡ | ä½¿ç”¨é¡µé¢ | ä¼˜å…ˆçº§ |
|------|------|---------|--------|
| å¯¼èˆªæ Logo | Logo4.png | é¦–é¡µ/æ‰€æœ‰é¡µé¢ | ğŸ”´ é«˜ |
| è½®æ’­å›¾ | BJ1-5.jpg | å¤‡ä»¶åº“é¡µé¢ | ğŸ”´ é«˜ |
| Heroå›¾ç‰‡ | sy.jpg | é¦–é¡µ | ğŸŸ¡ ä¸­ |
| å…³äºæˆ‘ä»¬ | Logo6.jpg | é¦–é¡µ/å…³äºé¡µé¢ | ğŸŸ¡ ä¸­ |
| å¾®ä¿¡äºŒç»´ç  | wx.jpg | å¾®ä¿¡æ¨¡æ€æ¡† | ğŸŸ¢ ä½ |
| ç³»ç»ŸLogo | Logo.jpg | çŸ¥è¯†åº“/å·¥å•ç³»ç»Ÿ | ğŸ”´ é«˜ |

### å½“å‰åŠ è½½ç¼“æ…¢åŸå› 

1. **å›¾ç‰‡æ–‡ä»¶è¿‡å¤§** - æœªå‹ç¼©çš„åŸå§‹å›¾ç‰‡
2. **æ ¼å¼ä¸åˆç†** - JPGç”¨äºç®€å•å›¾å½¢ï¼ŒPNGç”¨äºå¤æ‚å›¾åƒ
3. **æ— CDNåŠ é€Ÿ** - æ‰€æœ‰å›¾ç‰‡ä»æœåŠ¡å™¨ç›´æ¥åŠ è½½
4. **æ— æµè§ˆå™¨ç¼“å­˜** - Nginxç¼“å­˜é…ç½®å¯èƒ½æœªç”Ÿæ•ˆ
5. **æ— æ‡’åŠ è½½** - æ‰€æœ‰å›¾ç‰‡åŒæ—¶åŠ è½½
6. **æ— Redisç¼“å­˜** - çƒ­ç‚¹å›¾ç‰‡æœªç¼“å­˜
7. **ç½‘ç»œå»¶è¿Ÿ** - å…¬ç½‘è®¿é—®å¸¦å®½é™åˆ¶

---

## ğŸ¯ ä¼˜åŒ–ç›®æ ‡

| æŒ‡æ ‡ | å½“å‰å€¼ | ç›®æ ‡å€¼ | é¢„æœŸæå‡ |
|------|--------|--------|---------|
| é¦–é¡µåŠ è½½æ—¶é—´ | ~5-8ç§’ | < 2ç§’ | â¬†ï¸ 75% |
| é¦–å±å›¾ç‰‡å¤§å° | ~5MB | < 1MB | â¬‡ï¸ 80% |
| å›¾ç‰‡åŠ è½½æ—¶é—´ | 1-3ç§’ | < 500ms | â¬†ï¸ 500% |
| æœåŠ¡å™¨å¸¦å®½ | åŸå§‹ | é™ä½80% | â¬‡ï¸ 80% |

---

## ğŸ—ºï¸ ä¼˜åŒ–è·¯çº¿å›¾

### é˜¶æ®µä¸€ï¼šå›¾ç‰‡å‹ç¼©ä¸æ ¼å¼ä¼˜åŒ–ï¼ˆ1-2å¤©ï¼‰
```
â–¡ å›¾ç‰‡æ–‡ä»¶å‹ç¼©ï¼ˆJPG/PNGï¼‰
â–¡ å›¾ç‰‡æ ¼å¼è½¬æ¢ï¼ˆJPG â†’ WebPï¼‰
â–¡ ç”Ÿæˆå¤šå°ºå¯¸å›¾ç‰‡ï¼ˆå“åº”å¼ï¼‰
â–¡ å›¾ç‰‡è´¨é‡æµ‹è¯•
```

### é˜¶æ®µäºŒï¼šCDNåŠ é€Ÿï¼ˆ3-5å¤©ï¼‰
```
â–¡ é€‰æ‹©CDNæœåŠ¡å•†ï¼ˆé˜¿é‡Œäº‘/è…¾è®¯äº‘/ä¸ƒç‰›äº‘ï¼‰
â–¡ CDNè´¦å·é…ç½®
â–¡ é™æ€èµ„æºä¸Šä¼ 
â–¡ CDNåŸŸåé…ç½®
â–¡ DNSè§£æåˆ‡æ¢
```

### é˜¶æ®µä¸‰ï¼šRedisç¼“å­˜ï¼ˆ2-3å¤©ï¼‰
```
â–¡ RedisæœåŠ¡å™¨å®‰è£…é…ç½®
â–¡ Flaské›†æˆRedis
â–¡ å›¾ç‰‡ç¼“å­˜é€»è¾‘å®ç°
â–¡ ç¼“å­˜å¤±æ•ˆç­–ç•¥
â–¡ ç¼“å­˜ç›‘æ§
```

### é˜¶æ®µå››ï¼šå‰ç«¯ä¼˜åŒ–ï¼ˆ1-2å¤©ï¼‰
```
â–¡ å…³é”®å›¾ç‰‡é¢„åŠ è½½
â–¡ æ‡’åŠ è½½ä¼˜åŒ–
â–¡ å›¾ç‰‡å ä½ç¬¦
â–¡ æ¸è¿›å¼åŠ è½½
```

### é˜¶æ®µäº”ï¼šNginxä¼˜åŒ–ï¼ˆ1å¤©ï¼‰
```
â–¡ Gzipå‹ç¼©ä¼˜åŒ–
â–¡ ç¼“å­˜å¤´é…ç½®
â–¡ HTTP/2å¯ç”¨
â–¡ è´Ÿè½½å‡è¡¡é…ç½®
```

---

## ä¸€ã€å›¾ç‰‡å‹ç¼©ä¼˜åŒ–

### 1.1 å·¥å…·é€‰æ‹©

| å·¥å…· | ä¼˜ç‚¹ | ç¼ºç‚¹ | æ¨èåº¦ |
|------|------|------|--------|
| **TinyPNG API** | æ— æŸå‹ç¼©ï¼Œæ•ˆæœå¥½ | æœ‰é¢åº¦é™åˆ¶ | â­â­â­â­â­ |
| **ImageMagick** | åŠŸèƒ½å¼ºå¤§ï¼Œå¯ç¼–ç¨‹ | å‹ç¼©ç‡ä¸€èˆ¬ | â­â­â­â­ |
| **mozjpeg** | JPGå‹ç¼©ç‡é«˜ | ä»…æ”¯æŒJPG | â­â­â­â­ |
| **optipng** | PNGæ— æŸå‹ç¼© | ä»…æ”¯æŒPNG | â­â­â­â­ |
| **libwebp** | WebPè½¬æ¢ | éœ€è¦é¢å¤–å®‰è£… | â­â­â­â­â­ |

### 1.2 å‹ç¼©ç­–ç•¥

#### JPGå›¾ç‰‡å‹ç¼©
```
åŸè´¨é‡: 95-100
ç›®æ ‡è´¨é‡: 75-85
å‹ç¼©å·¥å…·: ImageMagick + mozjpeg
é¢„æœŸæ•ˆæœ: 70-80% ä½“ç§¯å‡å°‘
```

#### PNGå›¾ç‰‡å‹ç¼©
```
åŸè´¨é‡: æ— å‹ç¼©
ç›®æ ‡: PNG-8 + ä¼˜åŒ–
å‹ç¼©å·¥å…·: optipng + pngquant
é¢„æœŸæ•ˆæœ: 50-70% ä½“ç§¯å‡å°‘
```

#### WebPè½¬æ¢
```
åŸæ ¼å¼: JPG/PNG
ç›®æ ‡æ ¼å¼: WebP (æœ‰æŸ)
å‹ç¼©è´¨é‡: 80%
é¢„æœŸæ•ˆæœ: 80-90% ä½“ç§¯å‡å°‘
æµè§ˆå™¨æ”¯æŒ: ç°ä»£æµè§ˆå™¨95%+
```

### 1.3 å‹ç¼©è„šæœ¬è®¾è®¡

#### æ–¹æ¡ˆAï¼šæœ¬åœ°å‹ç¼©è„šæœ¬ï¼ˆæ¨èï¼‰

**æ–‡ä»¶**: `scripts/optimize_images_comprehensive.py`

```python
# åŠŸèƒ½è§„åˆ’
- æ‰¹é‡æ‰«æ static/ ç›®å½•æ‰€æœ‰å›¾ç‰‡
- è°ƒç”¨ ImageMagick è¿›è¡Œå‹ç¼©
- ç”Ÿæˆ WebP æ ¼å¼å‰¯æœ¬
- ç”Ÿæˆç¼©ç•¥å›¾ï¼ˆå¤šå°ºå¯¸ï¼‰
- å‹ç¼©å‰åå¯¹æ¯”æŠ¥å‘Š
- åŸå§‹æ–‡ä»¶å¤‡ä»½åˆ° backup/ ç›®å½•
```

**æ ¸å¿ƒç®—æ³•**:
```python
# 1. JPGå‹ç¼© â†’ è´¨é‡80ï¼Œä¿æŒåŸæ¯”ä¾‹
convert input.jpg -quality 80 -strip output.jpg

# 2. PNGå‹ç¼© â†’ PNG-8æ ¼å¼
convert input.png -resize 80% -depth 8 output.png
optipng -o7 output.png

# 3. WebPè½¬æ¢ â†’ è´¨é‡80
cwebp -q 80 input.jpg -o output.webp

# 4. ç”Ÿæˆå¤šå°ºå¯¸
convert input.jpg -resize 800x600 input_800x600.jpg
convert input.jpg -resize 400x300 input_400x300.jpg
```

#### æ–¹æ¡ˆBï¼šTinyPNG APIæ‰¹é‡å‹ç¼©

```python
# åŠŸèƒ½è§„åˆ’
- è¯»å–TinyPNG APIå¯†é’¥
- æ‰¹é‡ä¸Šä¼ å›¾ç‰‡åˆ°TinyPNG
- ä¸‹è½½å‹ç¼©åçš„å›¾ç‰‡
- è‡ªåŠ¨æ›¿æ¢åŸæ–‡ä»¶
- ç”Ÿæˆå‹ç¼©æŠ¥å‘Š
```

### 1.4 å¤šå°ºå¯¸å›¾ç‰‡ç­–ç•¥

#### å“åº”å¼å›¾ç‰‡æ–¹æ¡ˆ

| å›¾ç‰‡ç±»å‹ | åŸå§‹å°ºå¯¸ | ç”Ÿæˆå°ºå¯¸ | ä½¿ç”¨åœºæ™¯ |
|---------|---------|---------|---------|
| Logoå›¾ç‰‡ | åŸå§‹ | 1x, 2x, 3x | DPIé€‚é… |
| è½®æ’­å›¾ | 1200x600 | 1200x600, 800x400, 400x200 | å±å¹•å®½åº¦ |
| Heroå›¾ç‰‡ | 700x500 | 700x500, 350x250 | å“åº”å¼ |
| äºŒç»´ç  | 160x160 | 160x160, 80x80, 40x40 | ä¸åŒå±•ç¤ºå¤§å° |

#### HTMLå®ç°
```html
<!-- ä½¿ç”¨pictureå…ƒç´  -->
<picture>
  <source srcset="/static/home/images/sy.webp" type="image/webp">
  <source srcset="/static/home/images/sy.jpg" type="image/jpeg">
  <img src="/static/home/images/sy.jpg" 
       srcset="/static/home/images/sy_800.jpg 800w,
               /static/home/images/sy_400.jpg 400w"
       sizes="(max-width: 800px) 400px, 800px"
       loading="lazy"
       decoding="async">
</picture>
```

---

## äºŒã€å›¾ç‰‡æ ¼å¼ä¼˜åŒ–

### 2.1 æ ¼å¼é€‰æ‹©å»ºè®®

| åœºæ™¯ | åŸæ ¼å¼ | æ¨èæ ¼å¼ | åŸå›  |
|------|--------|---------|------|
| Logoï¼ˆç®€å•å›¾å½¢ï¼‰ | PNG | SVG | çŸ¢é‡ï¼Œæ— é™ç¼©æ”¾ï¼Œä½“ç§¯å° |
| Logoï¼ˆå¤æ‚ï¼‰ | PNG | PNG-8 | å‡å°‘è‰²å½©æ·±åº¦ |
| ç…§ç‰‡è½®æ’­ | JPG | WebP | æœ€é«˜å‹ç¼©ç‡ |
| äºŒç»´ç  | PNG | PNG-8 | é»‘ç™½ï¼Œå‡å°‘ä½“ç§¯ |
| çº¯è‰²èƒŒæ™¯ | JPG | PNG-8æˆ–SVG | æ— æŸï¼Œä½“ç§¯å° |

### 2.2 æ ¼å¼è½¬æ¢ä¼˜å…ˆçº§

```
é«˜ä¼˜å…ˆçº§ï¼ˆç«‹å³æ‰§è¡Œï¼‰:
â–¡ Logoå›¾ç‰‡ â†’ SVGï¼ˆå¦‚æœæºæ–‡ä»¶å¯ç”¨ï¼‰
â–¡ è½®æ’­å›¾ â†’ WebP
â–¡ äºŒç»´ç  â†’ PNG-8

ä¸­ä¼˜å…ˆçº§ï¼ˆé€æ­¥ä¼˜åŒ–ï¼‰:
â–¡ JPGå›¾ç‰‡ â†’ è´¨é‡å‹ç¼©
â–¡ PNGå›¾ç‰‡ â†’ PNG-8å‹ç¼©
â–¡ ç”ŸæˆWebPå‰¯æœ¬

ä½ä¼˜å…ˆçº§ï¼ˆåæœŸä¼˜åŒ–ï¼‰:
â–¡ ç”ŸæˆAVIFæ ¼å¼ï¼ˆæµè§ˆå™¨æ”¯æŒæå‡åï¼‰
â–¡ å®ç°è‡ªé€‚åº”å›¾ç‰‡æ ¼å¼
```

### 2.3 SVGæ–¹æ¡ˆï¼ˆæ¨èï¼‰

#### Logoè½¬SVGä¼˜åŠ¿
- æ— é™ç¼©æ”¾ä¸å¤±çœŸ
- ä½“ç§¯æå°ï¼ˆé€šå¸¸<10KBï¼‰
- å¯ç”¨CSSæ§åˆ¶é¢œè‰²
- æ”¯æŒåŠ¨ç”»æ•ˆæœ

#### è½¬æ¢æ–¹æ¡ˆ
```python
# æ–¹æ¡ˆ1: åœ¨çº¿è½¬æ¢æœåŠ¡
- ä½¿ç”¨ Adobe Illustrator å¯¼å‡ºSVG
- ä½¿ç”¨åœ¨çº¿è½¬æ¢å·¥å…·

# æ–¹æ¡ˆ2: ä»£ç é‡ç»˜ï¼ˆæ¨èï¼‰
- ä½¿ç”¨Inkscapeæ‰‹åŠ¨ç»˜åˆ¶
- ç²¾ç¡®æ§åˆ¶æ¯ä¸ªå…ƒç´ 
- å¯ç¼–è¾‘æ€§å¼º
```

---

## ä¸‰ã€CDNåŠ é€Ÿ

### 3.1 CDNæœåŠ¡å•†é€‰æ‹©

| æœåŠ¡å•† | å›½å†…èŠ‚ç‚¹ | å…è´¹é¢åº¦ | ä»·æ ¼ | æ¨èåº¦ |
|--------|---------|---------|------|--------|
| **é˜¿é‡Œäº‘CDN** | 2000+ | 100GB/æœˆ | Â¥0.24/GB | â­â­â­â­â­ |
| **è…¾è®¯äº‘CDN** | 2800+ | 100GB/æœˆ | Â¥0.21/GB | â­â­â­â­â­ |
| **ä¸ƒç‰›äº‘** | 50+ | 10GB/æœˆ | Â¥0.29/GB | â­â­â­â­ |
| **åˆæ‹äº‘** | 100+ | 20GB/æœˆ | Â¥0.18/GB | â­â­â­â­ |

### 3.2 CDNæ¶æ„æ–¹æ¡ˆ

#### æ–¹æ¡ˆAï¼šå…¨ç«™CDNï¼ˆæ¨èï¼‰
```
ç”¨æˆ· â†’ CDNè¾¹ç¼˜èŠ‚ç‚¹ â†’ æºç«™æœåŠ¡å™¨
                â†“
              å‘½ä¸­ç¼“å­˜ â†’ ç›´æ¥è¿”å›
              æœªå‘½ä¸­ â†’ å›æºæœåŠ¡å™¨
```

**ä¼˜ç‚¹**:
- é…ç½®ç®€å•
- æ‰€æœ‰èµ„æºéƒ½åŠ é€Ÿ
- è‡ªåŠ¨æ•…éšœåˆ‡æ¢

**ç¼ºç‚¹**:
- è´¹ç”¨è¾ƒé«˜
- éœ€è¦å¤‡æ¡ˆ

#### æ–¹æ¡ˆBï¼šä»…é™æ€èµ„æºCDN
```
HTML/åŠ¨æ€è¯·æ±‚ â†’ æºç«™æœåŠ¡å™¨
é™æ€èµ„æºè¯·æ±‚ â†’ CDNè¾¹ç¼˜èŠ‚ç‚¹
```

**ä¼˜ç‚¹**:
- è´¹ç”¨å¯æ§
- åŠ¨æ€å†…å®¹å®æ—¶
- é…ç½®çµæ´»

**ç¼ºç‚¹**:
- éœ€è¦é…ç½®CORS
- éœ€è¦ä¿®æ”¹ä»£ç 

### 3.3 CDNé…ç½®æ–¹æ¡ˆ

#### åŸŸåè§„åˆ’
```
ä¸»åŸŸå: www.yundour.com
CDNåŸŸå: cdn.yundour.com
```

#### ç¼“å­˜ç­–ç•¥
```
å›¾ç‰‡èµ„æº: 1å¹´
CSS/JS: 30å¤©
å­—ä½“: 1å¹´
HTML: ä¸ç¼“å­˜
```

#### å›æºé…ç½®
```
å›æºåè®®: HTTPS
å›æºHOST: www.yundour.com
å›æºç«¯å£: 443
```

### 3.4 ä»£ç ä¿®æ”¹æ–¹æ¡ˆ

#### Nginxé…ç½®ï¼ˆCDNå›æºï¼‰
```nginx
# æ·»åŠ CORSå¤´ï¼ˆå¦‚æœéœ€è¦è·¨åŸŸï¼‰
add_header Access-Control-Allow-Origin *;
add_header Access-Control-Allow-Methods 'GET, OPTIONS';
add_header Access-Control-Allow-Headers 'Origin, Content-Type';

# æ·»åŠ ETagï¼ˆç”¨äºCDNç¼“å­˜éªŒè¯ï¼‰
etag on;

# æ·»åŠ ç¼“å­˜æ§åˆ¶å¤´
add_header Cache-Control "public, max-age=31536000";
```

#### Flaské…ç½®ï¼ˆCDNæ”¯æŒï¼‰
```python
# config.py æ·»åŠ é…ç½®
CDN_ENABLED = True
CDN_DOMAIN = 'cdn.yundour.com'

# æ¨¡æ¿å‡½æ•°
from flask import url_for
def cdn_url_for(endpoint, **values):
    if CDN_ENABLED and endpoint.startswith('static'):
        # é™æ€èµ„æºèµ°CDN
        filename = values.get('filename', '')
        return f'https://{CDN_DOMAIN}/static/{filename}'
    else:
        # åŠ¨æ€è¯·æ±‚èµ°æºç«™
        return url_for(endpoint, **values)
```

---

## å››ã€Redisç¼“å­˜

### 4.1 Redisæ¶æ„è®¾è®¡

#### ç¼“å­˜æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Browser â”‚ â†’  â”‚  Nginx  â”‚ â†’  â”‚  Flask  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                              â†“
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚   Redis   â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ç¼“å­˜å±‚çº§
```
ç¬¬ä¸€å±‚: æµè§ˆå™¨ç¼“å­˜ï¼ˆCache-Controlï¼‰
ç¬¬äºŒå±‚: Nginxç¼“å­˜ï¼ˆFastCGI Cacheï¼‰
ç¬¬ä¸‰å±‚: Redisç¼“å­˜ï¼ˆåº”ç”¨å±‚ï¼‰
ç¬¬å››å±‚: æ•°æ®åº“/æ–‡ä»¶ç³»ç»Ÿ
```

### 4.2 Redisæ•°æ®ç»“æ„è®¾è®¡

#### å›¾ç‰‡ç¼“å­˜Keyè®¾è®¡
```
# Keyæ ¼å¼
image:{md5_file_hash}

# ç¤ºä¾‹
image:8a7f8c3b4d1e2a9f5c6d8b7a4e2c1f0d

# Valueæ ¼å¼
{
  "file_path": "/static/home/images/sy.jpg",
  "content_type": "image/jpeg",
  "size": 1024000,
  "created_at": "2026-02-11T10:00:00Z",
  "access_count": 150,
  "last_accessed": "2026-02-11T16:00:00Z"
}
```

#### å›¾ç‰‡å…ƒæ•°æ®ç¼“å­˜
```
# Keyæ ¼å¼
image:meta:{file_path}

# ç¤ºä¾‹
image:meta:/static/home/images/sy.jpg

# Valueæ ¼å¼
{
  "width": 1200,
  "height": 600,
  "format": "JPEG",
  "size_original": 2048000,
  "size_compressed": 1024000,
  "compression_ratio": 0.5,
  "webp_available": true,
  "sizes": [1200, 800, 400]
}
```

### 4.3 Redisç¼“å­˜ç­–ç•¥

#### ç¼“å­˜è¿‡æœŸç­–ç•¥
```
å›¾ç‰‡å†…å®¹ç¼“å­˜: 7å¤©
å›¾ç‰‡å…ƒæ•°æ®: 30å¤©
çƒ­ç‚¹å›¾ç‰‡: ä¸è¿‡æœŸï¼ŒLRUæ·˜æ±°
```

#### ç¼“å­˜é¢„çƒ­
```python
# åº”ç”¨å¯åŠ¨æ—¶é¢„çƒ­çƒ­ç‚¹å›¾ç‰‡
hot_images = [
    '/static/home/images/Logo4.png',
    '/static/home/images/sy.jpg',
    '/static/kb/images/Logo.jpg',
    '/static/case/images/Logo.jpg',
]

for img_path in hot_images:
    preload_image_to_redis(img_path)
```

#### ç¼“å­˜å¤±æ•ˆç­–ç•¥
```python
# æ–‡ä»¶ä¿®æ”¹æ—¶æ¸…é™¤ç¼“å­˜
@contextmanager
def update_image_file(file_path):
    old_hash = calculate_file_hash(file_path)
    yield
    new_hash = calculate_file_hash(file_path)
    if old_hash != new_hash:
        clear_image_cache(file_path)
```

### 4.4 Flaské›†æˆRedis

#### æ–¹æ¡ˆAï¼šFlask-Cachingï¼ˆæ¨èï¼‰
```python
# requirements.txt æ·»åŠ 
Flask-Caching==2.1.0
redis==5.0.1

# config.py æ·»åŠ é…ç½®
CACHE_TYPE = 'redis'
CACHE_REDIS_HOST = '127.0.0.1'
CACHE_REDIS_PORT = 6379
CACHE_REDIS_DB = 0
CACHE_REDIS_URL = f'redis://{CACHE_REDIS_HOST}:{CACHE_REDIS_PORT}/0'
CACHE_DEFAULT_TIMEOUT = 604800  # 7å¤©
```

#### æ–¹æ¡ˆBï¼šç›´æ¥ä½¿ç”¨Redis-py
```python
# requirements.txt æ·»åŠ 
redis==5.0.1

# services/image_cache.py
import redis
import hashlib
import os

class ImageCacheService:
    def __init__(self):
        self.redis = redis.Redis(
            host=config.CACHE_REDIS_HOST,
            port=config.CACHE_REDIS_PORT,
            db=0,
            decode_responses=False
        )
    
    def get_image(self, file_path):
        """è·å–ç¼“å­˜çš„å›¾ç‰‡å†…å®¹"""
        file_hash = self._calculate_hash(file_path)
        key = f"image:{file_hash}"
        return self.redis.get(key)
    
    def cache_image(self, file_path, content, ttl=604800):
        """ç¼“å­˜å›¾ç‰‡å†…å®¹"""
        file_hash = self._calculate_hash(file_path)
        key = f"image:{file_hash}"
        self.redis.setex(key, ttl, content)
```

### 4.5 Redisç›‘æ§

#### ç¼“å­˜å‘½ä¸­ç‡ç›‘æ§
```python
# services/cache_monitor.py
class CacheMonitor:
    def __init__(self):
        self.redis = redis.Redis(...)
        self.hits = 0
        self.misses = 0
    
    def record_hit(self):
        self.hits += 1
    
    def record_miss(self):
        self.misses += 1
    
    def get_hit_rate(self):
        total = self.hits + self.misses
        return self.hits / total if total > 0 else 0
```

---

## äº”ã€å‰ç«¯ä¼˜åŒ–

### 5.1 å…³é”®å›¾ç‰‡é¢„åŠ è½½

#### é¢„åŠ è½½ç­–ç•¥
```html
<!-- é¦–å±å…³é”®å›¾ç‰‡é¢„åŠ è½½ -->
<head>
  <link rel="preload" 
        href="/static/home/images/Logo4.png" 
        as="image" 
        importance="high">
  
  <link rel="preload" 
        href="/static/home/images/sy.jpg" 
        as="image" 
        importance="medium">
  
  <link rel="prefetch" 
        href="/static/home/images/Logo6.jpg" 
        as="image">
</head>
```

#### é¢„è¿æ¥CDNåŸŸå
```html
<link rel="dns-prefetch" href="https://cdn.yundour.com">
<link rel="preconnect" href="https://cdn.yundour.com">
```

### 5.2 æ‡’åŠ è½½ä¼˜åŒ–

#### æ–¹æ¡ˆAï¼šloading="lazy"ï¼ˆæ¨èï¼‰
```html
<!-- æ‰€æœ‰éé¦–å±å›¾ç‰‡æ·»åŠ æ‡’åŠ è½½ -->
<img src="{{ url_for('static', filename='home/images/BJ/BJ1.jpg') }}" 
     alt="å¤‡ä»¶åº“1" 
     loading="lazy" 
     decoding="async">
```

#### æ–¹æ¡ˆBï¼šIntersection Observer API
```javascript
// è‡ªå®šä¹‰æ‡’åŠ è½½ç±»
class LazyLoadImage {
  constructor(img) {
    this.img = img;
    this.observer = new IntersectionObserver(this.handleIntersect.bind(this));
    this.observer.observe(img);
  }
  
  handleIntersect(entries) {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        this.loadImage();
        this.observer.unobserve(this.img);
      }
    });
  }
  
  loadImage() {
    const src = this.img.dataset.src;
    this.img.src = src;
  }
}

// åˆå§‹åŒ–æ‡’åŠ è½½
document.querySelectorAll('img[data-src]').forEach(img => {
  new LazyLoadImage(img);
});
```

### 5.3 æ¸è¿›å¼åŠ è½½

#### Blurå ä½ç¬¦
```html
<div style="position: relative;">
  <!-- æ¨¡ç³Šé¢„è§ˆå›¾ -->
  <img src="/static/home/images/sy_small_blur.jpg" 
       style="filter: blur(20px); transition: filter 0.5s;"
       onload="this.style.filter='none'">
  
  <!-- åŸå›¾ -->
  <img src="/static/home/images/sy.jpg" 
       loading="lazy" 
       style="position: absolute; inset: 0; opacity: 0; transition: opacity 0.5s;"
       onload="this.style.opacity='1'">
</div>
```

#### Skeletonå±å ä½
```html
<div class="image-skeleton">
  <div class="skeleton-animation"></div>
</div>

<style>
.image-skeleton {
  width: 100%;
  height: 300px;
  background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
  background-size: 200% 100%;
}

.skeleton-animation {
  animation: skeleton-loading 1.5s infinite;
}

@keyframes skeleton-loading {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}
</style>
```

### 5.4 å“åº”å¼å›¾ç‰‡

#### srcsetå±æ€§
```html
<img 
  src="/static/home/images/sy_800.jpg" 
  srcset="/static/home/images/sy_400.jpg 400w,
          /static/home/images/sy_800.jpg 800w,
          /static/home/images/sy_1200.jpg 1200w"
  sizes="(max-width: 768px) 400px,
         (max-width: 1024px) 800px,
         1200px"
  loading="lazy">
```

#### pictureå…ƒç´ ï¼ˆWebPå›é€€ï¼‰
```html
<picture>
  <source srcset="/static/home/images/sy.webp" type="image/webp">
  <source srcset="/static/home/images/sy.jpg" type="image/jpeg">
  <img src="/static/home/images/sy.jpg" alt="äº‘æˆ·ç§‘æŠ€">
</picture>
```

---

## å…­ã€Nginxä¼˜åŒ–

### 6.1 HTTP/2å¯ç”¨

```nginx
# httpå—é…ç½®
http {
    # å¯ç”¨HTTP/2
    listen 443 ssl http2;
    
    # å¤šè·¯å¤ç”¨é…ç½®
    http2_max_concurrent_streams 128;
    http2_max_field_size 4k;
    http2_max_header_size 16k;
}
```

### 6.2 Gzipå‹ç¼©ä¼˜åŒ–

```nginx
# å¯ç”¨Brotliå‹ç¼©ï¼ˆæ¯”Gzipæ›´é«˜æ•ˆï¼‰
# éœ€è¦å®‰è£…nginx-brotliæ¨¡å—
brotli on;
brotli_comp_level 6;
brotli_types text/plain text/css application/json application/javascript text/xml application/xml;

# Gzipä½œä¸ºå›é€€
gzip on;
gzip_vary on;
gzip_min_length 1000;
gzip_comp_level 6;
gzip_types
    text/plain
    text/css
    text/javascript
    application/json
    application/javascript
    application/xml+rss
    image/svg+xml;
```

### 6.3 ç¼“å­˜å¤´ä¼˜åŒ–

```nginx
# å›¾ç‰‡æ–‡ä»¶é•¿æœŸç¼“å­˜
location ~* \.(jpg|jpeg|png|gif|webp|ico|svg)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
    add_header X-Content-Type-Options "nosniff";
}

# CSS/JSæ–‡ä»¶ä¸­ç­‰ç¼“å­˜
location ~* \.(css|js)$ {
    expires 30d;
    add_header Cache-Control "public, must-revalidate";
}

# HTMLæ–‡ä»¶ä¸ç¼“å­˜
location ~* \.html$ {
    expires -1;
    add_header Cache-Control "no-store, no-cache, must-revalidate";
    add_header Pragma "no-cache";
}
```

### 6.4 å¼€å¯æ–‡ä»¶ç¼“å­˜

```nginx
# æ–‡ä»¶ç³»ç»Ÿç¼“å­˜
open_file_cache max=10000 inactive=30s;
open_file_cache_valid 30s;
open_file_cache_min_uses 2;

# å‘é€æ–‡ä»¶ä¼˜åŒ–
sendfile on;
tcp_nopush on;
tcp_nodelay on;
```

---

## ä¸ƒã€ä»£ç å®ç°æ–¹æ¡ˆ

### 7.1 é¡¹ç›®ç»“æ„è°ƒæ•´

```
Integrate-code/
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ optimize_images_comprehensive.py  # å›¾ç‰‡å‹ç¼©è„šæœ¬ï¼ˆæ–°å¢ï¼‰
â”‚   â”œâ”€â”€ redis_setup.sh                  # Rediså®‰è£…è„šæœ¬ï¼ˆæ–°å¢ï¼‰
â”‚   â””â”€â”€ deploy_cdn.sh                  # CDNéƒ¨ç½²è„šæœ¬ï¼ˆæ–°å¢ï¼‰
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ image_cache.py                  # å›¾ç‰‡ç¼“å­˜æœåŠ¡ï¼ˆæ–°å¢ï¼‰
â”‚   â””â”€â”€ cache_monitor.py               # ç¼“å­˜ç›‘æ§ï¼ˆæ–°å¢ï¼‰
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ image_optimizer.py              # å›¾ç‰‡ä¼˜åŒ–å·¥å…·ï¼ˆæ–°å¢ï¼‰
â”‚   â””â”€â”€ cdn_uploader.py                # CDNä¸Šä¼ å·¥å…·ï¼ˆæ–°å¢ï¼‰
â””â”€â”€ config/
    â””â”€â”€ redis.conf                     # Redisé…ç½®ï¼ˆæ–°å¢ï¼‰
```

### 7.2 ä¾èµ–åŒ…æ·»åŠ 

```txt
# requirements.txt æ–°å¢
redis==5.0.1
Flask-Caching==2.1.0
Pillow==10.0.0          # å›¾ç‰‡å¤„ç†
requests==2.31.0        # CDN APIè°ƒç”¨
```

### 7.3 ç¯å¢ƒå˜é‡é…ç½®

```env
# .env æ–°å¢é…ç½®

# Redisé…ç½®
REDIS_HOST=127.0.0.1
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=
REDIS_MAX_CONNECTIONS=50

# CDNé…ç½®
CDN_ENABLED=True
CDN_DOMAIN=cdn.yundour.com
CDN_PROTOCOL=https
CDN_BUCKET=yundour-static

# å›¾ç‰‡ä¼˜åŒ–é…ç½®
IMAGE_QUALITY=80
IMAGE_ENABLE_WEBP=True
IMAGE_AUTO_COMPRESS=True
IMAGE_CACHE_TTL=604800

# ç¼“å­˜é…ç½®
CACHE_TYPE=redis
CACHE_DEFAULT_TIMEOUT=604800
CACHE_KEY_PREFIX=yundour_
```

### 7.4 æ ¸å¿ƒä»£ç æ–‡ä»¶è®¾è®¡

#### æ–‡ä»¶1: services/image_cache.py
```python
# åŠŸèƒ½è®¾è®¡
- ImageCacheServiceç±»
- å›¾ç‰‡ç¼“å­˜å­˜å‚¨/è·å–
- ç¼“å­˜é¢„çƒ­
- ç¼“å­˜å¤±æ•ˆ
- ç¼“å­˜ç»Ÿè®¡

# ä¸»è¦æ–¹æ³•
- get_image(file_path)
- cache_image(file_path, content, ttl)
- preload_hot_images()
- invalidate_cache(file_path)
- get_cache_stats()
```

#### æ–‡ä»¶2: utils/image_optimizer.py
```python
# åŠŸèƒ½è®¾è®¡
- ImageOptimizerç±»
- å›¾ç‰‡å‹ç¼©ï¼ˆJPG/PNGï¼‰
- WebPè½¬æ¢
- å¤šå°ºå¯¸ç”Ÿæˆ
- æ ¼å¼è½¬æ¢

# ä¸»è¦æ–¹æ³•
- compress_jpg(input_path, output_path, quality)
- compress_png(input_path, output_path)
- convert_to_webp(input_path, output_path, quality)
- generate_responsive_images(input_path, sizes)
- optimize_all(directory)
```

#### æ–‡ä»¶3: routes/cdn_bp.py
```python
# åŠŸèƒ½è®¾è®¡
- CDNä¸Šä¼ ç®¡ç†è·¯ç”±
- å›¾ç‰‡é¢„è§ˆè·¯ç”±
- æ‰¹é‡ä¸Šä¼ æ¥å£
- CDNçŠ¶æ€ç›‘æ§

# ä¸»è¦è·¯ç”±
- GET /cdn/upload - ä¸Šä¼ é¡µé¢
- POST /cdn/upload - æ‰¹é‡ä¸Šä¼ 
- GET /cdn/status - CDNçŠ¶æ€
- POST /cdn/sync - åŒæ­¥åˆ°CDN
```

---

## å…«ã€å®æ–½æ­¥éª¤

### Phase 1: å›¾ç‰‡å‹ç¼©ï¼ˆDay 1-2ï¼‰

**ç›®æ ‡**: å°†æ‰€æœ‰å›¾ç‰‡å‹ç¼©è‡³ç›®æ ‡å¤§å°

#### Step 1.1: ç¯å¢ƒå‡†å¤‡
```bash
# å®‰è£…å›¾ç‰‡å¤„ç†å·¥å…·
sudo apt-get update
sudo apt-get install imagemagick webp optipng pngquant

# éªŒè¯å®‰è£…
convert -version
cwebp -version
```

#### Step 1.2: åˆ›å»ºå‹ç¼©è„šæœ¬
```bash
# scripts/optimize_images_comprehensive.py
# ï¼ˆè§ç¬¬7.3èŠ‚ä»£ç è®¾è®¡ï¼‰
```

#### Step 1.3: æ‰§è¡Œå‹ç¼©
```bash
# å¤‡ä»½åŸå§‹å›¾ç‰‡
cp -r static static_backup

# æ‰§è¡Œå‹ç¼©
python scripts/optimize_images_comprehensive.py

# éªŒè¯å‹ç¼©æ•ˆæœ
python scripts/optimize_images_comprehensive.py --verify
```

#### Step 1.4: æµ‹è¯•éªŒè¯
```bash
# æ£€æŸ¥å›¾ç‰‡å¤§å°
ls -lh static/home/images/
ls -lh static/kb/images/
ls -lh static/case/images/

# æœ¬åœ°æµ‹è¯•å¯åŠ¨
python app.py
# æµè§ˆå™¨æµ‹è¯•å›¾ç‰‡åŠ è½½
```

**éªŒæ”¶æ ‡å‡†**:
- âœ… æ‰€æœ‰å›¾ç‰‡å‹ç¼©å®Œæˆ
- âœ… å›¾ç‰‡å¤§å°å‡å°‘70%ä»¥ä¸Š
- âœ… å›¾ç‰‡è´¨é‡æ— æ˜æ˜¾ä¸‹é™
- âœ… WebPæ ¼å¼ç”Ÿæˆ

---

### Phase 2: Redisç¼“å­˜ï¼ˆDay 3-4ï¼‰

**ç›®æ ‡**: å®ç°å›¾ç‰‡Redisç¼“å­˜

#### Step 2.1: Rediså®‰è£…é…ç½®
```bash
# å®‰è£…Redis
sudo apt-get install redis-server

# å¯åŠ¨Redis
sudo systemctl start redis-server
sudo systemctl enable redis-server

# éªŒè¯å®‰è£…
redis-cli ping
# åº”è¿”å› PONG
```

#### Step 2.2: Flaské›†æˆ
```bash
# å®‰è£…ä¾èµ–
pip install redis Flask-Caching

# ä¿®æ”¹é…ç½®æ–‡ä»¶
# ï¼ˆè§ç¬¬7.3èŠ‚ç¯å¢ƒå˜é‡é…ç½®ï¼‰
```

#### Step 2.3: åˆ›å»ºç¼“å­˜æœåŠ¡
```bash
# åˆ›å»º services/image_cache.py
# ï¼ˆè§ç¬¬7.3èŠ‚ä»£ç è®¾è®¡ï¼‰
```

#### Step 2.4: ä¿®æ”¹è·¯ç”±
```python
# ä¿®æ”¹é™æ€æ–‡ä»¶è·¯ç”±ï¼Œä½¿ç”¨Redisç¼“å­˜
from services.image_cache import ImageCacheService

cache_service = ImageCacheService()

@app.route('/static/<path:filename>')
def serve_static(filename):
    # å°è¯•ä»Redisè·å–
    cached_content = cache_service.get_image(filename)
    if cached_content:
        return Response(cached_content, mimetype='image/jpeg')
    
    # ä»æ–‡ä»¶ç³»ç»Ÿè¯»å–
    with open(f'static/{filename}', 'rb') as f:
        content = f.read()
    
    # å†™å…¥ç¼“å­˜
    cache_service.cache_image(filename, content)
    
    return Response(content, mimetype='image/jpeg')
```

#### Step 2.5: æµ‹è¯•éªŒè¯
```bash
# é‡å¯Flaskåº”ç”¨
python app.py

# è®¿é—®å›¾ç‰‡
curl -I http://localhost:5000/static/home/images/sy.jpg

# æ£€æŸ¥Redisç¼“å­˜
redis-cli
> KEYS image:*
> GET image:8a7f8c3b4d1e2a9f5c6d8b7a4e2c1f0d
```

**éªŒæ”¶æ ‡å‡†**:
- âœ… Redisæ­£å¸¸è¿è¡Œ
- âœ… å›¾ç‰‡èƒ½æ­£å¸¸ç¼“å­˜åˆ°Redis
- âœ… ç¼“å­˜å‘½ä¸­æ—¥å¿—æ­£ç¡®
- âœ… ç¼“å­˜å¤±æ•ˆæœºåˆ¶æœ‰æ•ˆ

---

### Phase 3: CDNéƒ¨ç½²ï¼ˆDay 5-7ï¼‰

**ç›®æ ‡**: å°†é™æ€èµ„æºéƒ¨ç½²åˆ°CDN

#### Step 3.1: CDNè´¦å·æ³¨å†Œ
```bash
# é€‰æ‹©CDNæœåŠ¡å•†ï¼ˆä»¥é˜¿é‡Œäº‘ä¸ºä¾‹ï¼‰
# è®¿é—® https://cdn.console.aliyun.com
# æ³¨å†Œè´¦å·å¹¶å®åè®¤è¯
```

#### Step 3.2: åˆ›å»ºCDNåŠ é€ŸåŸŸå
```
1. æ·»åŠ åŠ é€ŸåŸŸå: cdn.yundour.com
2. é…ç½®æºç«™: www.yundour.com
3. é€‰æ‹©åŠ é€Ÿç±»å‹: å›¾ç‰‡åŠ é€Ÿ
4. å¼€å¯HTTPSï¼ˆä¸Šä¼ è¯ä¹¦ï¼‰
5. é…ç½®CNAME
```

#### Step 3.3: DNSè§£æé…ç½®
```
åœ¨åŸŸåDNSç®¡ç†ä¸­æ·»åŠ CNAMEè®°å½•:

è®°å½•ç±»å‹: CNAME
ä¸»æœºè®°å½•: cdn
è®°å½•å€¼: cdn.yundour.com.w.kunlunsl.com
TTL: 600
```

#### Step 3.4: é™æ€èµ„æºä¸Šä¼ 
```python
# scripts/cdn_uploader.py
# ï¼ˆè§ç¬¬7.3èŠ‚ä»£ç è®¾è®¡ï¼‰

# æ‰§è¡Œä¸Šä¼ 
python scripts/cdn_uploader.py --source static --bucket yundour-static
```

#### Step 3.5: ä»£ç ä¿®æ”¹æ”¯æŒCDN
```python
# ä¿®æ”¹æ¨¡æ¿å‡½æ•°æ”¯æŒCDN
# ï¼ˆè§ç¬¬3.4èŠ‚ä»£ç ä¿®æ”¹æ–¹æ¡ˆï¼‰
```

#### Step 3.6: æµ‹è¯•éªŒè¯
```bash
# æ£€æŸ¥CDNè§£æ
nslookup cdn.yundour.com

# è®¿é—®CDNèµ„æº
curl -I https://cdn.yundour.com/static/home/images/sy.jpg

# æŸ¥çœ‹å“åº”å¤´ï¼ˆåº”åŒ…å«CDNèŠ‚ç‚¹ä¿¡æ¯ï¼‰
X-Cache: HIT
```

**éªŒæ”¶æ ‡å‡†**:
- âœ… CDNåŸŸåè§£ææ­£ç¡®
- âœ… é™æ€èµ„æºèƒ½ä»CDNè®¿é—®
- âœ… ç¼“å­˜å‘½ä¸­ç‡>90%
- âœ… å›¾ç‰‡åŠ è½½æ—¶é—´<500ms

---

### Phase 4: å‰ç«¯ä¼˜åŒ–ï¼ˆDay 8-9ï¼‰

**ç›®æ ‡**: å®ç°æ‡’åŠ è½½å’Œæ¸è¿›å¼åŠ è½½

#### Step 4.1: ä¿®æ”¹æ¨¡æ¿æ–‡ä»¶
```html
<!-- ä¿®æ”¹æ‰€æœ‰éé¦–å±å›¾ç‰‡ -->
<!-- æ·»åŠ  loading="lazy" -->
<!-- æ·»åŠ  decoding="async" -->
```

#### Step 4.2: å®ç°é¢„åŠ è½½
```html
<!-- templates/home/base.html -->
<head>
  <!-- æ·»åŠ å…³é”®å›¾ç‰‡é¢„åŠ è½½ -->
  <link rel="preload" href="{{ cdn_url_for('static', filename='home/images/Logo4.png') }}" as="image">
  <link rel="preload" href="{{ cdn_url_for('static', filename='home/images/sy.jpg') }}" as="image">
</head>
```

#### Step 4.3: å®ç°æ‡’åŠ è½½
```javascript
// static/js/lazyload.jsï¼ˆæ–°å¢æ–‡ä»¶ï¼‰
// ï¼ˆè§ç¬¬5.2èŠ‚Intersection Observeræ–¹æ¡ˆï¼‰
```

#### Step 4.4: æµ‹è¯•éªŒè¯
```bash
# Chrome DevToolsæµ‹è¯•
1. æ‰“å¼€DevTools â†’ Network
2. å‹¾é€‰ Disable cache
3. åˆ·æ–°é¡µé¢
4. è§‚å¯Ÿå›¾ç‰‡åŠ è½½é¡ºåº
5. æ£€æŸ¥lazyåŠ è½½æ•ˆæœ
```

**éªŒæ”¶æ ‡å‡†**:
- âœ… é¦–å±å›¾ç‰‡ä¼˜å…ˆåŠ è½½
- âœ… éé¦–å±å›¾ç‰‡æ‡’åŠ è½½
- âœ… é¢„åŠ è½½å›¾ç‰‡ä¼˜å…ˆåŠ è½½
- âœ… æ— å›¾ç‰‡åŠ è½½é—ªçƒ

---

### Phase 5: Nginxä¼˜åŒ–ï¼ˆDay 10ï¼‰

**ç›®æ ‡**: ä¼˜åŒ–Nginxé…ç½®æå‡æ€§èƒ½

#### Step 5.1: å¤‡ä»½é…ç½®
```bash
sudo cp /etc/nginx/nginx.conf /etc/nginx/nginx.conf.backup
```

#### Step 5.2: åº”ç”¨ä¼˜åŒ–é…ç½®
```nginx
# docs/nginx_optimized_v2.confï¼ˆæ–°å¢æ–‡ä»¶ï¼‰
# ï¼ˆè§ç¬¬6èŠ‚Nginxä¼˜åŒ–ï¼‰
```

#### Step 5.3: æµ‹è¯•é…ç½®
```bash
# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡è½½Nginx
sudo systemctl reload nginx
```

#### Step 5.4: æ€§èƒ½æµ‹è¯•
```bash
# ä½¿ç”¨abå·¥å…·å‹æµ‹
ab -n 1000 -c 10 http://localhost/static/home/images/sy.jpg

# æ£€æŸ¥Gzip
curl -H "Accept-Encoding: gzip" -I http://localhost/static/home/images/sy.jpg
```

**éªŒæ”¶æ ‡å‡†**:
- âœ… é…ç½®æµ‹è¯•é€šè¿‡
- âœ… Nginxæ­£å¸¸è¿è¡Œ
- âœ… Gzipå‹ç¼©ç”Ÿæ•ˆ
- âœ… ç¼“å­˜å¤´æ­£ç¡®

---

## ä¹ã€æ•ˆæœè¯„ä¼°

### 9.1 æ€§èƒ½æŒ‡æ ‡ç›‘æ§

#### ç›‘æ§å·¥å…·
```bash
# å®‰è£…Lighthouse
npm install -g lighthouse

# æ‰§è¡Œæ€§èƒ½æµ‹è¯•
lighthouse https://www.yundour.com --view
```

#### å…³é”®æŒ‡æ ‡
| æŒ‡æ ‡ | ç›®æ ‡å€¼ | æµ‹é‡å·¥å…· |
|------|--------|---------|
| First Contentful Paint (FCP) | < 1.8s | Lighthouse |
| Largest Contentful Paint (LCP) | < 2.5s | Lighthouse |
| Time to Interactive (TTI) | < 3.8s | Lighthouse |
| Cumulative Layout Shift (CLS) | < 0.1 | Lighthouse |
| å›¾ç‰‡åŠ è½½æ—¶é—´ | < 500ms | Chrome DevTools |
| ç¼“å­˜å‘½ä¸­ç‡ | > 90% | Redis/Nginxæ—¥å¿— |

### 9.2 é¢„æœŸæ•ˆæœ

#### å›¾ç‰‡å¤§å°å¯¹æ¯”

| æ–‡ä»¶ | åŸå§‹å¤§å° | å‹ç¼©å | å‹ç¼©ç‡ |
|------|---------|---------|--------|
| Logo4.png | 200KB | 50KB | 75% |
| sy.jpg | 2MB | 400KB | 80% |
| BJ/BJ1.jpg | 1.5MB | 300KB | 80% |
| Logo.jpg | 500KB | 100KB | 80% |
| wx.jpg | 100KB | 20KB | 80% |
| **æ€»è®¡** | **5MB** | **1MB** | **80%** |

#### åŠ è½½æ—¶é—´å¯¹æ¯”

| åœºæ™¯ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|------|--------|--------|------|
| é¦–é¡µé¦–å± | 5-8s | 1-2s | 75% |
| å¤‡ä»¶åº“è½®æ’­ | 8-12s | 2-3s | 75% |
| çŸ¥è¯†åº“é¡µé¢ | 3-5s | 0.5-1s | 80% |
| å·¥å•ç³»ç»Ÿ | 3-5s | 0.5-1s | 80% |

### 9.3 æŒç»­ä¼˜åŒ–

#### ç›‘æ§æŒ‡æ ‡
```python
# services/performance_monitor.py
class PerformanceMonitor:
    def track_page_load(self, url):
        """è®°å½•é¡µé¢åŠ è½½æ—¶é—´"""
        
    def track_image_load(self, image_path):
        """è®°å½•å›¾ç‰‡åŠ è½½æ—¶é—´"""
        
    def generate_report(self):
        """ç”Ÿæˆæ€§èƒ½æŠ¥å‘Š"""
```

#### è‡ªåŠ¨å‘Šè­¦
```python
# å¦‚æœåŠ è½½æ—¶é—´è¶…è¿‡é˜ˆå€¼ï¼Œå‘é€å‘Šè­¦
if avg_load_time > 2.0:
    send_alert(f"å›¾ç‰‡åŠ è½½ç¼“æ…¢: {avg_load_time:.2f}s")
```

---

## ğŸ“Š æ€»ç»“

### ä¼˜åŒ–æ–¹æ¡ˆæ±‡æ€»

| ä¼˜åŒ–é¡¹ | é¢„æœŸæå‡ | å®æ–½éš¾åº¦ | ä¼˜å…ˆçº§ |
|--------|---------|---------|--------|
| å›¾ç‰‡å‹ç¼© | 70-80% ä½“ç§¯å‡å°‘ | â­â­ ä¸­ | ğŸ”´ é«˜ |
| WebPè½¬æ¢ | 80-90% ä½“ç§¯å‡å°‘ | â­â­â­ ä¸­é«˜ | ğŸ”´ é«˜ |
| Redisç¼“å­˜ | 90%+ ç¼“å­˜å‘½ä¸­ç‡ | â­â­â­ ä¸­é«˜ | ğŸ”´ é«˜ |
| CDNåŠ é€Ÿ | 500%+ åŠ è½½æå‡ | â­â­â­â­ é«˜ | ğŸŸ¡ ä¸­ |
| æ‡’åŠ è½½ | 50% å¸¦å®½å‡å°‘ | â­ ä½ | ğŸ”´ é«˜ |
| å“åº”å¼å›¾ç‰‡ | 30% ä½“ç§¯å‡å°‘ | â­â­â­ ä¸­ | ğŸŸ¡ ä¸­ |
| Nginxä¼˜åŒ– | 20-30% æå‡ | â­ ä½ | ğŸŸ¡ ä¸­ |

### å®æ–½æ—¶é—´è¡¨

```
Week 1: å›¾ç‰‡å‹ç¼© + Redisç¼“å­˜ï¼ˆ5å¤©ï¼‰
Week 2: CDNéƒ¨ç½² + å‰ç«¯ä¼˜åŒ–ï¼ˆ5å¤©ï¼‰
Week 3: Nginxä¼˜åŒ– + ç›‘æ§ä¸Šçº¿ï¼ˆ3å¤©ï¼‰
```

### é¢„æœŸæ€»æ•ˆæœ

- ğŸ“¦ å›¾ç‰‡å¤§å°å‡å°‘ 80%
- âš¡ åŠ è½½é€Ÿåº¦æå‡ 500%
- ğŸ’° æœåŠ¡å™¨å¸¦å®½èŠ‚çœ 80%
- ğŸ“Š ç¼“å­˜å‘½ä¸­ç‡ > 90%
- ğŸ¯ é¦–é¡µåŠ è½½ < 2ç§’

---

<div align="center">

**æ–‡æ¡£ç‰ˆæœ¬: v1.0**  
**åˆ›å»ºæ—¥æœŸ: 2026-02-11**  
**æœ€åæ›´æ–°: 2026-02-11**

</div>
