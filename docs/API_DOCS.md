# äº‘æˆ·ç§‘æŠ€ç½‘ç«™ - API æ–‡æ¡£

> RESTful API æ¥å£å®Œæ•´è¯´æ˜

---

## ğŸ“‹ ç›®å½•

- [é€šç”¨è¯´æ˜](#-é€šç”¨è¯´æ˜)
- [è®¤è¯è¯´æ˜](#-è®¤è¯è¯´æ˜)
- [å“åº”æ ¼å¼](#-å“åº”æ ¼å¼)
- [çŸ¥è¯†åº“ API](#-çŸ¥è¯†åº“-api)
  - [æœç´¢ Trilium ç¬”è®°](#æœç´¢-trilium-ç¬”è®°)
  - [è·å–ç¬”è®°å†…å®¹](#è·å–ç¬”è®°å†…å®¹)
  - [æµ‹è¯• Trilium è¿æ¥](#æµ‹è¯•-trilium-è¿æ¥)
  - [Trilium é™„ä»¶ä»£ç†](#trilium-é™„ä»¶ä»£ç†)
- [ç”¨æˆ·ç®¡ç† API](#-ç”¨æˆ·ç®¡ç†-api)
  - [æ·»åŠ ç”¨æˆ·](#æ·»åŠ ç”¨æˆ·)
  - [æ›´æ–°ç”¨æˆ·](#æ›´æ–°ç”¨æˆ·)
  - [åˆ é™¤ç”¨æˆ·](#åˆ é™¤ç”¨æˆ·)
  - [é‡ç½®å¯†ç ](#é‡ç½®å¯†ç )
- [å·¥å• API](#-å·¥å•-api)
- [ç»Ÿä¸€ç”¨æˆ· API](#-ç»Ÿä¸€ç”¨æˆ·-api)

---

## ğŸ“ é€šç”¨è¯´æ˜

### åŸºç¡€ URL

```
http://your-server:5000
```

### è®¤è¯æ–¹å¼

å¤§å¤šæ•° API éœ€è¦ **Session è®¤è¯**ï¼š

1. ç”¨æˆ·ç™»å½•åï¼ŒSession Cookie è‡ªåŠ¨ä¿å­˜è®¤è¯ä¿¡æ¯
2. è¯·æ±‚æ—¶è‡ªåŠ¨æºå¸¦ Session Cookie
3. éƒ¨åˆ† API éœ€è¦ç‰¹å®šè§’è‰²æƒé™

### è§’è‰²æƒé™

| è§’è‰² | æƒé™ | è¯´æ˜ |
|------|--------|------|
| `admin` | å®Œå…¨æƒé™ | æ‰€æœ‰ç³»ç»Ÿè®¿é—®æƒé™ |
| `user` | çŸ¥è¯†åº“ç”¨æˆ· | çŸ¥è¯†åº“è®¿é—®æƒé™ |
| `customer` | å®¢æˆ·ç”¨æˆ· | å·¥å•ç³»ç»Ÿè®¿é—®æƒé™ |
| `editor` | ç¼–è¾‘ç”¨æˆ· | å†…å®¹ç¼–è¾‘æƒé™ |

### HTTP çŠ¶æ€ç 

| çŠ¶æ€ç  | è¯´æ˜ |
|--------|------|
| 200 | æˆåŠŸ |
| 400 | å‚æ•°é”™è¯¯ |
| 401 | æœªè®¤è¯ |
| 403 | æƒé™ä¸è¶³ |
| 404 | èµ„æºä¸å­˜åœ¨ |
| 500 | æœåŠ¡å™¨é”™è¯¯ |

---

## ğŸ” è®¤è¯è¯´æ˜

### ç™»å½•

```http
POST /kb/auth/login
Content-Type: application/x-www-form-urlencoded

username=admin&password=YHKB@2024
```

### ç™»å‡º

```http
GET /kb/auth/logout
```

### æ£€æŸ¥ç™»å½•çŠ¶æ€

```http
GET /kb/auth/check-login
```

---

## ğŸ“¦ å“åº”æ ¼å¼

### æˆåŠŸå“åº”

```json
{
  "success": true,
  "message": "æ“ä½œæˆåŠŸ",
  "data": { ... }
}
```

### é”™è¯¯å“åº”

```json
{
  "success": false,
  "message": "é”™è¯¯æè¿°"
}
```

---

## ğŸ“š çŸ¥è¯†åº“ API

### æœç´¢ Trilium ç¬”è®°

æœç´¢ Trilium ç¬”è®°ç³»ç»Ÿä¸­çš„å†…å®¹ã€‚

**ç«¯ç‚¹:** `GET /api/trilium/search`

**è®¤è¯:** éœ€è¦ç™»å½•

**å‚æ•°:**

| å‚æ•° | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|------|--------|--------|------|
| `q` | string | æ˜¯ | æœç´¢å…³é”®è¯ |
| `limit` | integer | å¦ | è¿”å›ç»“æœæ•°é‡é™åˆ¶ï¼ˆé»˜è®¤: 30ï¼‰ |

**è¯·æ±‚ç¤ºä¾‹:**

```http
GET /api/trilium/search?q=éƒ¨ç½²&limit=10
```

**å“åº”ç¤ºä¾‹:**

```json
{
  "success": true,
  "message": "æœç´¢å®Œæˆ",
  "data": {
    "results": [
      {
        "noteId": "0x10TVJeyncl",
        "title": "éƒ¨ç½²æŒ‡å—",
        "type": "text",
        "dateModified": "2026-01-15T10:30:00Z"
      }
    ],
    "query": "éƒ¨ç½²",
    "count": 1
  }
}
```

---

### è·å–ç¬”è®°å†…å®¹

è·å– Trilium ç¬”è®°çš„è¯¦ç»†å†…å®¹ã€‚

**ç«¯ç‚¹:** `GET /api/trilium/content`

**è®¤è¯:** éœ€è¦ç™»å½•

**å‚æ•°:**

| å‚æ•° | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|------|--------|--------|------|
| `kb_number` | string | å¦ | çŸ¥è¯†åº“ç¼–å·ï¼ˆç”¨äºæŸ¥è¯¢æ ‡é¢˜ç­‰å…ƒæ•°æ®ï¼‰ |
| `trilium_url` | string | æ˜¯ | Trilium ç¬”è®° URL |

**è¯·æ±‚ç¤ºä¾‹:**

```http
GET /api/trilium/content?kb_number=1001&trilium_url=http%3A%2F%2F10.10.10.250%3A8080%2F%23root%2F0x10TVJeyncl
```

**å“åº”ç¤ºä¾‹:**

```json
{
  "success": true,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "content": "<div>ç¬”è®°å†…å®¹...</div>",
    "title": "éƒ¨ç½²æ–‡æ¡£",
    "modified": "2026-01-15 10:30:00",
    "kb_number": "1001",
    "url": "http://10.10.10.250:8080/#root/0x10TVJeyncl"
  }
}
```

---

### æµ‹è¯• Trilium è¿æ¥

æµ‹è¯• Trilium æœåŠ¡è¿æ¥çŠ¶æ€ã€‚

**ç«¯ç‚¹:** `GET /api/trilium/test`

**è®¤è¯:** éœ€è¦ç™»å½•

**å“åº”ç¤ºä¾‹:**

```json
{
  "success": true,
  "message": "Trilium è¿æ¥æˆåŠŸ",
  "data": {
    "server_url": "http://10.10.10.250:8080"
  }
}
```

---

### Trilium é™„ä»¶ä»£ç†

ä»£ç†è®¿é—® Trilium ç¬”è®°ä¸­çš„å›¾ç‰‡é™„ä»¶ã€‚

**ç«¯ç‚¹:** `GET /kb/api/attachments/<attachment_path>`

**è®¤è¯:** éœ€è¦ç™»å½•

**è·¯å¾„æ ¼å¼:** `ZjD0OZLY4aWU/image/f6f83bfe35c1711a70ed62a985ab1a92.png`

**è¯´æ˜:** åªä½¿ç”¨ç¬¬ä¸€æ®µä½œä¸º `attachment_id`ï¼Œå…¶ä½™éƒ¨åˆ†ç”¨äºæ„å»ºå®Œæ•´ URL

**å“åº”:** ç›´æ¥è¿”å›å›¾ç‰‡æ–‡ä»¶ï¼ˆimage/pngï¼‰

---

## ğŸ‘¥ ç”¨æˆ·ç®¡ç† API

### æ·»åŠ ç”¨æˆ·

åˆ›å»ºæ–°çš„çŸ¥è¯†åº“ç”¨æˆ·ã€‚

**ç«¯ç‚¹:** `POST /auth/api/add-user`

**è®¤è¯:** éœ€è¦ç®¡ç†å‘˜æƒé™

**Content-Type:** `application/json`

**è¯·æ±‚ä½“:**

| å­—æ®µ | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|------|--------|--------|------|
| `username` | string | æ˜¯ | ç”¨æˆ·åï¼ˆå¿…é¡»å”¯ä¸€ï¼‰ |
| `password` | string | æ˜¯ | å¯†ç ï¼ˆæœ€å°‘ 6 ä½ï¼‰ |
| `display_name` | string | å¦ | æ˜¾ç¤ºåç§° |
| `email` | string | å¦ | é‚®ç®±åœ°å€ |
| `role` | string | å¦ | è§’è‰²ï¼ˆé»˜è®¤: userï¼‰ |

**å¯†ç å¤æ‚åº¦è¦æ±‚:**
- è‡³å°‘ 6 ä¸ªå­—ç¬¦
- å»ºè®®åŒ…å«å¤§å†™å­—æ¯ã€å°å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šç¬¦å·
- é¿å…ä½¿ç”¨å¸¸è§å¯†ç ï¼ˆå¦‚ 123456ã€passwordï¼‰

**è¯·æ±‚ç¤ºä¾‹:**

```json
{
  "username": "newuser",
  "password": "Secure@123",
  "display_name": "æ–°ç”¨æˆ·",
  "email": "newuser@example.com",
  "role": "user"
}
```

**å“åº”ç¤ºä¾‹:**

```json
{
  "success": true,
  "message": "ç”¨æˆ·åˆ›å»ºæˆåŠŸ"
}
```

---

### æ›´æ–°ç”¨æˆ·

æ›´æ–°ç”¨æˆ·ä¿¡æ¯ã€‚

**ç«¯ç‚¹:** `PUT /auth/api/update-user/<user_id>`

**è®¤è¯:** éœ€è¦ç®¡ç†å‘˜æƒé™

**Content-Type:** `application/json`

**è¯·æ±‚ä½“:**

| å­—æ®µ | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|------|--------|--------|------|
| `display_name` | string | å¦ | æ˜¾ç¤ºåç§° |
| `email` | string | å¦ | é‚®ç®±åœ°å€ |
| `role` | string | å¦ | è§’è‰² |
| `status` | string | å¦ | çŠ¶æ€ï¼ˆactive/inactive/lockedï¼‰ |
| `password` | string | å¦ | æ–°å¯†ç ï¼ˆå¦‚éœ€ä¿®æ”¹ï¼‰ |

**è¯·æ±‚ç¤ºä¾‹:**

```json
{
  "display_name": "æ›´æ–°æ˜¾ç¤ºåç§°",
  "email": "updated@example.com",
  "role": "user",
  "status": "active"
}
```

**å“åº”ç¤ºä¾‹:**

```json
{
  "success": true,
  "message": "ç”¨æˆ·æ›´æ–°æˆåŠŸ"
}
```

---

### åˆ é™¤ç”¨æˆ·

åˆ é™¤æŒ‡å®šç”¨æˆ·ã€‚

**ç«¯ç‚¹:** `DELETE /auth/api/delete-user/<user_id>`

**è®¤è¯:** éœ€è¦ç®¡ç†å‘˜æƒé™

**é™åˆ¶:**
- ä¸èƒ½åˆ é™¤å½“å‰ç™»å½•ç”¨æˆ·
- ä¸èƒ½åˆ é™¤ ID ä¸º 1 çš„ admin ç”¨æˆ·

**å“åº”ç¤ºä¾‹:**

```json
{
  "success": true,
  "message": "ç”¨æˆ·åˆ é™¤æˆåŠŸ"
}
```

**é”™è¯¯å“åº”:**

```json
{
  "success": false,
  "message": "ä¸èƒ½åˆ é™¤ admin ç”¨æˆ·"
}
```

---

### é‡ç½®å¯†ç 

ç®¡ç†å‘˜é‡ç½®æŒ‡å®šç”¨æˆ·çš„å¯†ç ã€‚

**ç«¯ç‚¹:** `POST /auth/api/reset-password/<user_id>`

**è®¤è¯:** éœ€è¦ç®¡ç†å‘˜æƒé™

**Content-Type:** `application/json`

**è¯·æ±‚ä½“:**

| å­—æ®µ | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|------|--------|--------|------|
| `password` | string | æ˜¯ | æ–°å¯†ç ï¼ˆæœ€å°‘ 6 ä½ï¼‰ |

**é™åˆ¶:**
- ä¸èƒ½é‡ç½® ID ä¸º 1 çš„ admin ç”¨æˆ·

**è¯·æ±‚ç¤ºä¾‹:**

```json
{
  "password": "NewSecure@123"
}
```

**å“åº”ç¤ºä¾‹:**

```json
{
  "success": true,
  "message": "ç”¨æˆ· username çš„å¯†ç å·²é‡ç½®"
}
```

---

## ğŸ« å·¥å• API

### åˆ›å»ºå·¥å•

åˆ›å»ºæ–°çš„å®¢æˆ·å·¥å•ã€‚

**ç«¯ç‚¹:** `POST /case/api/tickets`

**è®¤è¯:** éœ€è¦ç™»å½•

**Content-Type:** `application/json`

**è¯·æ±‚ä½“:**

| å­—æ®µ | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|------|--------|--------|------|
| `title` | string | æ˜¯ | å·¥å•æ ‡é¢˜ |
| `description` | string | æ˜¯ | å·¥å•æè¿° |
| `priority` | string | å¦ | ä¼˜å…ˆçº§ï¼ˆlow/medium/highï¼‰ |
| `category` | string | å¦ | å·¥å•åˆ†ç±» |

**å“åº”ç¤ºä¾‹:**

```json
{
  "success": true,
  "message": "å·¥å•åˆ›å»ºæˆåŠŸ",
  "data": {
    "ticket_id": 123,
    "ticket_number": "TK-2026-0001"
  }
}
```

### è·å–å·¥å•åˆ—è¡¨

è·å–å·¥å•åˆ—è¡¨ã€‚

**ç«¯ç‚¹:** `GET /case/api/tickets`

**è®¤è¯:** éœ€è¦ç™»å½•

**å‚æ•°:**

| å‚æ•° | ç±»å‹ | è¯´æ˜ |
|------|--------|------|
| `page` | integer | é¡µç ï¼ˆé»˜è®¤: 1ï¼‰ |
| `per_page` | integer | æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤: 20ï¼‰ |
| `status` | string | çŠ¶æ€ç­›é€‰ |

### è·å–å·¥å•è¯¦æƒ…

**ç«¯ç‚¹:** `GET /case/api/tickets/<ticket_id>`

**è®¤è¯:** éœ€è¦ç™»å½•

---

## ğŸ‘¥ ç»Ÿä¸€ç”¨æˆ· API

### è·å–ç”¨æˆ·åˆ—è¡¨

è·å–æ‰€æœ‰ç”¨æˆ·åˆ—è¡¨ã€‚

**ç«¯ç‚¹:** `GET /unified/api/users`

**è®¤è¯:** éœ€è¦ç®¡ç†å‘˜æƒé™

**å“åº”ç¤ºä¾‹:**

```json
{
  "success": true,
  "message": "è·å–ç”¨æˆ·åˆ—è¡¨æˆåŠŸ",
  "data": [
    {
      "id": 1,
      "username": "admin",
      "display_name": "ç®¡ç†å‘˜",
      "email": "admin@example.com",
      "role": "admin",
      "status": "active",
      "created_at": "2026-01-01 10:00:00"
    }
  ]
}
```

### è·å–ç”¨æˆ·ç»Ÿè®¡

è·å–ç”¨æˆ·å’Œç™»å½•æ—¥å¿—ç»Ÿè®¡ä¿¡æ¯ã€‚

**ç«¯ç‚¹:** `GET /unified/api/user-stats`

**è®¤è¯:** éœ€è¦ç®¡ç†å‘˜æƒé™

**å“åº”ç¤ºä¾‹:**

```json
{
  "success": true,
  "message": "è·å–ç»Ÿè®¡ä¿¡æ¯æˆåŠŸ",
  "data": {
    "users": {
      "total": 25,
      "active": 23,
      "admins": 3,
      "customers": 10,
      "kb_users": 15
    },
    "login_logs": {
      "total": 1523,
      "today": 45,
      "success": 1480,
      "failed": 43
    }
  }
}
```

---

## ğŸ§ª çŸ¥è¯†åº“ç®¡ç† API

### è·å–çŸ¥è¯†åº“è®°å½•

**ç«¯ç‚¹:** `GET /kb/MGMT/api/records`

**è®¤è¯:** éœ€è¦ç®¡ç†å‘˜æƒé™

**å‚æ•°:**

| å‚æ•° | ç±»å‹ | è¯´æ˜ |
|------|--------|------|
| `page` | integer | é¡µç  |
| `per_page` | integer | æ¯é¡µæ•°é‡ |
| `search` | string | æœç´¢å…³é”®è¯ |

### æ·»åŠ çŸ¥è¯†åº“è®°å½•

**ç«¯ç‚¹:** `POST /kb/MGMT/api/records`

**è®¤è¯:** éœ€è¦ç®¡ç†å‘˜æƒé™

### æ›´æ–°çŸ¥è¯†åº“è®°å½•

**ç«¯ç‚¹:** `PUT /kb/MGMT/api/records/<record_id>`

**è®¤è¯:** éœ€è¦ç®¡ç†å‘˜æƒé™

### åˆ é™¤çŸ¥è¯†åº“è®°å½•

**ç«¯ç‚¹:** `DELETE /kb/MGMT/api/records/<record_id>`

**è®¤è¯:** éœ€è¦ç®¡ç†å‘˜æƒé™

### æ‰¹é‡åˆ é™¤è®°å½•

**ç«¯ç‚¹:** `POST /kb/MGMT/api/batch-delete`

**è®¤è¯:** éœ€è¦ç®¡ç†å‘˜æƒé™

**Content-Type:** `application/json`

**è¯·æ±‚ä½“:**

```json
{
  "ids": [1, 2, 3]
}
```

**å“åº”ç¤ºä¾‹:**

```json
{
  "success": true,
  "message": "æˆåŠŸåˆ é™¤ 3 æ¡è®°å½•"
}
```

### å¯¼å‡ºçŸ¥è¯†åº“æ•°æ®

**ç«¯ç‚¹:** `GET /kb/MGMT/api/export`

**è®¤è¯:** éœ€è¦ç®¡ç†å‘˜æƒé™

---

## ğŸŒ å®˜ç½‘ API

### æäº¤è”ç³»è¡¨å•

**ç«¯ç‚¹:** `POST /api/contact`

**Content-Type:** `application/json`

**è¯·æ±‚ä½“:**

```json
{
  "name": "å¼ ä¸‰",
  "email": "zhangsan@example.com",
  "subject": "å’¨è¯¢",
  "message": "æ‚¨å¥½ï¼Œæˆ‘æƒ³äº†è§£äº§å“..."
}
```

---

## ğŸ”§ é…ç½® API

### è·å–ç³»ç»ŸçŠ¶æ€

**ç«¯ç‚¹:** `GET /kb/MGMT/api/system-status`

**è®¤è¯:** éœ€è¦ç®¡ç†å‘˜æƒé™

**å“åº”ç¤ºä¾‹:**

```json
{
  "success": true,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "database": "connected",
    "trilium": "connected",
    "total_records": 1234,
    "total_users": 25
  }
}
```

---

## ğŸ“š æ›´å¤šæ–‡æ¡£

- [ç³»ç»ŸæŒ‡å—é¦–é¡µ](./README.md)
- [çŸ¥è¯†åº“ç³»ç»ŸæŒ‡å—](./KB_SYSTEM_GUIDE.md)
- [å·¥å•ç³»ç»ŸæŒ‡å—](./CASE_SYSTEM_GUIDE.md)
- [ç»Ÿä¸€ç”¨æˆ·ç®¡ç†æŒ‡å—](./UNIFIED_SYSTEM_GUIDE.md)

---

<div align="center">

**API ç‰ˆæœ¬: v2.0** | æœ€åæ›´æ–°: 2026-02-10

</div>
