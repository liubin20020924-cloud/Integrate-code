# Nginx 图片优化配置
# 将此配置添加到您的 Nginx 配置文件中

http {
    # ========== Gzip 压缩配置 ==========
    gzip on;
    gzip_vary on;
    gzip_min_length 1000;
    gzip_comp_level 6;
    gzip_types
        text/plain
        text/css
        text/xml
        text/javascript
        application/json
        application/javascript
        application/xml+rss
        application/rss+xml
        application/atom+xml
        image/svg+xml
        application/x-font-ttf
        font/opentype
        application/vnd.ms-fontobject;

    # ========== Brotli 压缩（更高效）==========
    # 需要先安装 ngx_brotli 模块
    # brotli on;
    # brotli_comp_level 6;
    # brotli_types text/plain text/css application/json application/javascript image/svg+xml;
}

server {
    listen 80;
    server_name your-domain.com;

    # ========== 图片缓存配置 ==========
    location ~* \.(jpg|jpeg|png|gif|webp|ico|svg)$ {
        # 设置过期时间（1年）
        expires 1y;

        # 缓存控制策略
        add_header Cache-Control "public, immutable";

        # 不记录访问日志
        access_log off;

        # 启用 sendfile
        sendfile on;

        # TCP_NOPUSH 推送数据包
        tcp_nopush on;
    }

    # ========== 静态文件缓存 ==========
    location ~* \.(css|js)$ {
        expires 30d;
        add_header Cache-Control "public, must-revalidate";
    }

    # ========== 字体文件缓存 ==========
    location ~* \.(woff|woff2|ttf|otf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
        access_log off;
    }

    # ========== 禁用日志的静态资源 ==========
    location = /favicon.ico {
        access_log off;
        log_not_found off;
    }

    location = /robots.txt {
        access_log off;
        log_not_found off;
    }
}
